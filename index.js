/**
 * qi-nodes 0.0.4
 * http://drkibitz.github.io/qi-nodes/
 * Copyright (c) 2013 Dr. Kibitz, http://drkibitz.com
 * Base implementation for composite patterns in JavaScript.
 * built: Mon Jan 27 2014 22:56:09 GMT-0800 (PST)
 */
!function(i){"use strict";function t(i){this.message=i||"A node was inserted somewhere it doesn't belong."}function r(i){i.childCount=0,i.firstChild=i.lastChild=i.nextSibling=i.parent=i.previousSibling=i.root=null}function e(i){var t=i.parent,r=i.nextSibling,e=i.previousSibling;return t.childCount--,r?r.previousSibling=e:t.lastChild=e,e?e.nextSibling=r:t.firstChild=r,i.parent=i.nextSibling=i.previousSibling=null,i}function n(i){var t=i.root,r=i.parent?i.parent.root:null;t&&i.onRemoved&&i.onRemoved(t),r&&i.onInserted&&i.onInserted(r),i.root=r}function o(){r(this)}t.prototype=new Error,t.prototype.name="HierarchyRequestError";var s=o.prototype;s.append=function(i,t){return this.appendTo(t||this,i)},s.appendTo=function(i,t){var r,o=i.lastChild;if(t=t||this,t==i)throw new this.HierarchyRequestError;return t!=o&&(t.parent&&e(t),t.parent=i,r=0|i.childCount,i.childCount=r+1,o&&(t.previousSibling=o,o.nextSibling=t),i.lastChild=t,i.firstChild||(i.firstChild=t),t.root!=i.root&&this.each(n,t)),t},s.create=function(i){var t=new this.NodeObject;return i&&this.appendTo(i,t),t},s.createRoot=function(){var i=new this.RootObject;return i.root=i,i},s.destroy=function(i,t){return t=t||this,i?this.eachReverse(r,t):(t.root=null,t.parent&&e(t),t.firstChild&&this.empty(i,t)),t},s.each=function l(i,t,r){var e,n;for(t=t||this,r=0|r,e=t.firstChild,i(t,r);e;)n=e.nextSibling,l(i,e,r+1),e=n;return t},s.eachParent=function h(i,t,r){return t=t||this,r=0|r,t.parent&&h(i,t.parent,r+1),i(t,r),t},s.eachReverse=function u(i,t,r){var e,n;for(t=t||this,r=0|r,e=t.lastChild;e;)n=e.previousSibling,u(i,e,r+1),e=n;return i(t,r),t},s.empty=function(i,t){var e,n;for(t=t||this,e=t.firstChild,e&&i&&(t.childCount=0,t.firstChild=t.lastChild=null);e;)n=e.nextSibling,i?this.eachReverse(r,e):this.remove(e),e=n;return t},s.insertAfter=function(i,t){var r,o,s=i.nextSibling;if(t=t||this,t!=i&&t!=s){if(r=i.parent,!r||t==r)throw new this.HierarchyRequestError;t.parent&&e(t),t.previousSibling=i,t.nextSibling=s,t.parent=r,s?s.previousSibling=t:r.lastChild=t,i.nextSibling=t,o=0|r.childCount,r.childCount=o+1,t.root!=r.root&&this.each(n,t)}return t},s.insertBefore=function(i,t){var r,o,s=i.previousSibling;if(t=t||this,t!=i&&t!=s){if(r=i.parent,!r||t==r)throw new this.HierarchyRequestError;t.parent&&e(t),t.previousSibling=s,t.nextSibling=i,t.parent=r,s?s.nextSibling=t:r.firstChild=t,i.previousSibling=t,o=0|r.childCount,r.childCount=o+1,t.root!=r.root&&this.each(n,t)}return t},s.prepend=function(i,t){return this.prependTo(t||this,i)},s.prependTo=function(i,t){var r,o=i.firstChild;if(t=t||this,t==i)throw new this.HierarchyRequestError;return t!=o&&(t.parent&&e(t),t.parent=i,r=0|i.childCount,i.childCount=r+1,o&&(t.nextSibling=o,o.previousSibling=t),i.firstChild=t,i.lastChild||(i.lastChild=t),t.root!=i.root&&this.each(n,t)),t},s.remove=function(i){return i=e(i||this),i.root?this.each(n,i):i},s.swap=function(i,t){var r,e,o,s,l,h=i.nextSibling;return t=t||this,i!=t&&(r=i.parent,e=i.previousSibling,o=t.nextSibling,s=t.parent,l=t.previousSibling,i.nextSibling=o,i.parent=s,i.previousSibling=l,o?o.previousSibling=i:s&&(s.lastChild=i),l?l.nextSibling=i:s&&(s.firstChild=i),t.nextSibling=h,t.parent=r,t.previousSibling=e,h?h.previousSibling=t:r&&(r.lastChild=t),e?e.nextSibling=t:r&&(r.firstChild=t),(i.root&&!s||i.root!=s.root)&&this.each(n,i),(t.root&&!r||t.root!=r.root)&&this.each(n,t)),i},s.NodeObject=s.RootObject=o,s.HierarchyRequestError=t,i.exports=s.createRoot()}(module,exports);